<div class="hot-list-container">
  <!-- <ul class="breadcrumb">
        <li><a (click)="navigateToDashboard()">Home</a></li>
        <li class="last">Portal Requirements</li>
    </ul> -->
  <div class="header-container mat-elevation-z1">
    <span class="header-text"> Portal Requirements </span>
    <div>
      <mat-form-field class="portal-form-field">
        <mat-label>Select a Portal</mat-label>
        <mat-select (selectionChange)="onSelectionChange($event)">
          <mat-option *ngFor="let option of currentOptions" [value]="option.value">
            {{ option.label }}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>
    <div class="hot-list-actions">
      <div class="search-hot-list">
        <input matInput type="text" class="search" placeholder="search " (keyup)="applyFilter($event)" />
      </div>
    </div>
  </div>

  <div id="table-container" class="table-wrapper">
    <mat-tab-group (selectedTabChange)="onTabChanged($event)" mat-stretch-tabs="false" mat-align-tabs="start"
      color="primary" backgroundColor="primary">
      <mat-tab *ngFor="let tab of tabs" [label]="tab">
        <ng-container *ngTemplateOutlet="tableTemplate; context: { status: tab }"></ng-container>
      </mat-tab>
    </mat-tab-group>

    <ng-template #tableTemplate>
      <section class="mat-elevation-z8 hot-list-table-style">
        <table mat-table [dataSource]="dataSource" oncopy="return false">
          <!--- Note that these columns can be defined in any order.
                    The actual rendered columns are set as a property on the row definition" -->

          <!-- SNo Column mat-sort-header sortActionDescription="Sort by Serial Number"-->
          <ng-container matColumnDef="SerialNum">
            <th mat-header-cell *matHeaderCellDef style="width: 1%">S.No</th>
            <td mat-cell *matCellDef="let element" style="width: 1%">
              {{ element?.serialNum }}
            </td>
          </ng-container>

          <!-- Name Column mat-sort-header sortActionDescription="Sort by Name"-->
          <ng-container matColumnDef="posted_on">
            <th mat-header-cell *matHeaderCellDef style="width: 2%">
              Posted On
            </th>
            <td mat-cell *matCellDef="let element" nowrap style="width: 2%">
              {{
              isValidDate(element?.requirement.posted_on)
              ? (element?.requirement.posted_on | date : "MM-dd-yyyy HH:mm")
              : "N/A"
              }}
            </td>
          </ng-container>

          <!-- Technology Column mat-sort-header sortActionDescription="Sort by Technology"-->
          <ng-container matColumnDef="job_title">
            <th mat-header-cell *matHeaderCellDef style="width: 20%">Title</th>
            <td mat-cell *matCellDef="let element" style="width: 20%">
              <span class="consultant-name"><a href="{{ element?.requirement.job_source }}" target="_blank"
                  (click)="empTag(element.requirement.id)">{{ element?.requirement.job_title | titlecase }}</a>
              </span>
            </td>
          </ng-container>
          <ng-container matColumnDef="consultantName">
            <th mat-header-cell *matHeaderCellDef>Consultants</th>
            <td mat-cell *matCellDef="let element">
              <div class="avatar-group">
                <!-- first three avatars -->
                <ng-container *ngFor="
                    let c of firstThree(element.consultants);
                    let i = index
                  ">
                  <div class="avatar" [ngStyle]="{ 'background-color': avatarColors[i] }" (click)="
                    openConsultantDialog(element.consultants);
                    $event.stopPropagation()
                  " style="cursor: pointer;" [title]="c.conName">
                    {{ c.conName.charAt(0).toUpperCase() }}
                  </div>
                </ng-container>

                <!-- +N badge opens dialog -->
                <div *ngIf="element.consultants.length > 3" class="avatar more-badge" style="cursor: pointer" (click)="
                    openConsultantDialog(element.consultants);
                    $event.stopPropagation()
                  " [title]="
                    'View all ' + element.consultants.length + ' consultants'
                  ">
                  +{{ element.consultants.length - 3 }}
                </div>
              </div>
            </td>
          </ng-container>

          <!-- Visa Column mat-sort-header sortActionDescription="Sort by Visa" -->
          <!-- <ng-container matColumnDef="category_skill">
                        <th mat-header-cell *matHeaderCellDef style="width: 13%">
                            Category </th>
                        <td mat-cell *matCellDef="let element"style="width: 13%">
                            {{ element?.category_skill | titlecase }} </td>
                    </ng-container> -->

          <!-- Experience Column  sortActionDescription="Sort by Experience"-->
          <ng-container matColumnDef="employment_type">
            <th mat-header-cell *matHeaderCellDef style="width: 4%">
              Emp Type
            </th>
            <td mat-cell *matCellDef="let element" style="width: 4%">
              {{ element?.requirement.employment_type | titlecase }}
            </td>
          </ng-container>

          <!-- Experience Column sortActionDescription="Sort by Experience"-->
          <ng-container matColumnDef="job_location">
            <th mat-header-cell *matHeaderCellDef style="width: 10%">
              Location
            </th>
            <td mat-cell *matCellDef="let element" style="width: 10%">
              {{ element?.requirement.job_location | titlecase }}
            </td>
          </ng-container>

          <!-- Rate Column mat-sort-header sortActionDescription="Sort by Rate"-->
          <ng-container matColumnDef="vendor">
            <th mat-header-cell *matHeaderCellDef style="width: 12%">Vendor</th>
            <td mat-cell *matCellDef="let element" class="req-info" (click)="goToReqInfo(element)" style="width: 12%">
              {{ element?.requirement.vendor | titlecase }}
            </td>
          </ng-container>

          <!-- Body Column sortActionDescription="Sort by JobDescription"-->
          <ng-container matColumnDef="JobDescription">
            <th mat-header-cell *matHeaderCellDef style="width: 3%">
              Job Description
            </th>
            <td mat-cell *matCellDef="let element" class="jd-info" (click)="goToJobDescription(element)"
              style="width: 3%">
              VIEW
            </td>
          </ng-container>

          <!-- comments -->
          <ng-container matColumnDef="Comments">
            <th mat-header-cell *matHeaderCellDef style="width: 3%">
              Comments
            </th>
            <td mat-cell *matCellDef="let element" style="width: 3%">
              <span class="action-buttons">
                <button mat-icon-button class="action-button-ed" (click)="jobComments(element)">
                  <mat-icon>comment</mat-icon>
                </button>
                <span class="bold-text">({{ element?.requirement.commentsCount || "0" }})</span>
              </span>
            </td>
          </ng-container>

          <!-- <ng-container matColumnDef="Matching">
                        <th mat-header-cell *matHeaderCellDef style="width: 3%"> Matching </th>
                        <td mat-cell *matCellDef="let element">
                            <button mat-raised-button color="primary" style="width: max-content; height: fit-content; padding: 4px !important;" (click)="matching(element)">
                                check
                            </button>
                        </td>
                    </ng-container> -->

          <!-- Source Column mat-sort-header sortActionDescription="Sort by Source"-->
          <ng-container matColumnDef="source">
            <th mat-header-cell *matHeaderCellDef style="width: 3%">Source</th>
            <td mat-cell *matCellDef="let element" nowrap style="width: 3%">
              {{ element?.requirement.source | titlecase }}
            </td>
          </ng-container>
          <ng-container matColumnDef="ResumeUpload">
            <th mat-header-cell *matHeaderCellDef style="width: 3%">
              Resume Upload
            </th>
            <td mat-cell *matCellDef="let element" nowrap style="width: 3%">
              <button mat-icon-button (click)="triggerFileUpload(fileInputRef)">
                <mat-icon>upload</mat-icon>
              </button>

              <!-- Hidden File Input (One per row) -->
              <input type="file" #fileInputRef accept=".pdf,.doc,.docx" style="display: none"
                (change)="onFileSelectedata($event, element)" />
            </td>
          </ng-container>

          <ng-container matColumnDef="Percentage">
            <th mat-header-cell *matHeaderCellDef style="width: 3%">
              Percentage
            </th>
            <td mat-cell *matCellDef="let element" nowrap style="width: 3%; text-align: center">
              {{ element?.requirement.percentage || "N/A" }}
            </td>
          </ng-container>

          <!-- table ROW -->
          <tr mat-header-row *matHeaderRowDef="dataTableColumns; sticky: true"></tr>
          <tr mat-row *matRowDef="let row; columns: dataTableColumns" [ngStyle]="getRowStyles(row)"></tr>
        </table>
        <p class="no-data-found" *ngIf="!dataSource.data.length">
          {{ "No matching data found" }}
        </p>
      </section>
      <hr />
    </ng-template>
  </div>

  <div class="paginator" *ngIf="dataSource.filteredData.length">
    <!-- paginator -->
    <mat-paginator (page)="handlePageEvent($event)" [length]="totalItems" [pageSize]="pageSize" [disabled]="false"
      [showFirstLastButtons]="showFirstLastButtons" [pageSizeOptions]="showPageSizeOptions ? pageSizeOptions : []"
      [hidePageSize]="true" [pageIndex]="currentPageIndex" aria-label="Select page">
    </mat-paginator>
  </div>
</div>
<!-- … your mat-table for the main list … -->

<ng-template #consultantDialog>
  <h2 mat-dialog-title class="dialog-header">
    <div class="header-left">
      <span class="title-text">Consultants</span>
    </div>

    <div class="header-right">
      <div class="searchconsultant-hot-list">
        <input matInput type="text" class="search" placeholder="Search" (keyup)="consultanttable($event)" />
      </div>
      <button mat-icon-button class="close-button" (click)="onCancel()">
        <mat-icon>close</mat-icon>
      </button>
    </div>
  </h2>



  <mat-dialog-content>
    <table mat-table [dataSource]="pagedConsultants" class="mat-elevation-z1">
      <!-- Serial # Column -->
      <!-- Serial # Column -->
      <!-- Serial # Column -->
      <ng-container matColumnDef="serialNum">
        <th mat-header-cell *matHeaderCellDef sticky>SerialNo</th>
        <td mat-cell *matCellDef="let c; let i = index">
          {{ (currentPage - 1) * pageSizeConsultants + i + 1 }}
        </td>
      </ng-container>

      <!-- Consultant Column -->
      <ng-container matColumnDef="conName">
        <th mat-header-cell *matHeaderCellDef sticky>Consultant</th>
        <td mat-cell *matCellDef="let c">{{ c.conName }}</td>
      </ng-container>

      <!-- % Match Column -->
      <ng-container matColumnDef="percentage">
        <th mat-header-cell *matHeaderCellDef sticky>Percentage</th>
        <td mat-cell *matCellDef="let c">
          {{ c.percentage | number : "1.0-2" }}%
        </td>
      </ng-container>

      <!-- Matched Skills Column -->
      <ng-container matColumnDef="matchedSkills">
        <th mat-header-cell *matHeaderCellDef sticky>Matched Skills</th>
        <td mat-cell *matCellDef="let c" style="    max-width: 24rem;">

          {{ c.matchedSkills || "-" }}
        </td>
      </ng-container>

      <!-- Unmatched Skills Column -->
      <ng-container matColumnDef="unMatchedSkills">
        <th mat-header-cell *matHeaderCellDef sticky>Mismatched Skills</th>
        <td mat-cell *matCellDef="let c" style="    max-width: 24rem;">

          {{ c.unMatchedSkills || "-" }}
        </td>
      </ng-container>

      <!-- Header & Rows -->
      <tr mat-header-row *matHeaderRowDef="[
          'serialNum',
          'conName',
          'percentage',
          'matchedSkills',
          'unMatchedSkills'
        ]"></tr>
      <tr mat-row *matRowDef="
          let row;
          columns: [
            'serialNum',
            'conName',
            'percentage',
            'matchedSkills',
            'unMatchedSkills'
          ]
        "></tr>


    </table>
    <!-- No matching data found -->
    <div *ngIf="filteredConsultants.length === 0" style="    text-align: center;
    padding: 39px 13px;
    font-weight: 700;
    color: black;
    font-size: 16px;">
      No matching data found
    </div>
  </mat-dialog-content>

  <mat-dialog-actions>
    <div class="custom-pagination">
      <button mat-icon-button (click)="prevPage()" [disabled]="currentPage === 1">
        <mat-icon>chevron_left</mat-icon>
      </button>

      <button *ngFor="let pg of getPageNumbers()" (click)="goToPage(pg)" [class.active]="currentPage === pg">
        {{ pg }}
      </button>

      <button mat-icon-button (click)="nextPage()" [disabled]="currentPage === totalPages">
        <mat-icon>chevron_right</mat-icon>
      </button>
    </div>
  </mat-dialog-actions>
</ng-template>